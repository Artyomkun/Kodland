{"version":3,"sources":["../src/index.ts","../src/tls.ts","../src/types.ts","../src/errors.ts","../src/corsFetch.ts"],"sourcesContent":["/**\r\n * CorsBridge - Zero-Config CORS Proxy Client\r\n * \r\n * @packageDocumentation\r\n */\r\n\r\nexport { corsFetch, corsGet, corsPost, corsPut, corsPatch, corsDelete } from './corsFetch';\r\nexport type { \r\n  CorsFetchOptions, \r\n  ErrorResponse, \r\n  CorsBridgeOptions,\r\n  CorsBridgeResponse,\r\n  CorsBridgeErrorDetails \r\n} from './types';\r\nexport { ErrorType } from './types';\r\nexport {\r\n  CorsBridgeError,\r\n  ValidationError,\r\n  RateLimitError,\r\n  PayloadTooLargeError,\r\n  BadGatewayError,\r\n  GatewayTimeoutError,\r\n  NetworkError,\r\n  HostBlockedError,\r\n  SSRFBlockedError,\r\n  InvalidURLError,\r\n  TimeoutError,\r\n  TargetError,\r\n} from './errors';\r\n\r\n","import https from 'https';\r\nimport { Agent as UndiciAgent, setGlobalDispatcher } from 'undici';\r\n\r\nlet configured = false;\r\n\r\n/**\r\n * Disables TLS session caching for both the legacy HTTPS agent and undici dispatcher.\r\n * Prevents Cloudflare from rejecting reused session IDs (ERR_SSL_INVALID_SESSION_ID).\r\n */\r\nexport function disableTlsSessionReuse(): void {\r\n\tif (configured) {\r\n\t\treturn;\r\n\t}\r\n\tconst agent = https.globalAgent as https.Agent & { maxCachedSessions?: number };\r\n\tif (agent.options) {\r\n\t\tagent.options.maxCachedSessions = 0;\r\n\t}\r\n\tif (typeof agent.maxCachedSessions === 'number') {\r\n\t\tagent.maxCachedSessions = 0;\r\n\t}\r\n\r\n\ttry {\r\n\t\tconst dispatcher = new UndiciAgent({\r\n\t\t\tconnect: {\r\n\t\t\t\tmaxCachedSessions: 0,\r\n\t\t\t},\r\n\t\t\tpipelining: 0,\r\n\t\t});\r\n\t\tsetGlobalDispatcher(dispatcher);\r\n\t} catch (error) {\r\n\t\t// eslint-disable-next-line no-console\r\n\t\tconsole.warn('Failed to configure undici TLS guard', error);\r\n\t}\r\n\r\n\tconfigured = true;\r\n}\r\n\r\ndisableTlsSessionReuse();","/**\r\n * CorsBridge Request Options\r\n */\r\nexport interface CorsFetchOptions {\r\n  /** HTTP method (GET, POST, PUT, PATCH, DELETE, etc.) */\r\n  method?: string;\r\n  \r\n  /** Request headers */\r\n  headers?: Record<string, string>;\r\n  \r\n  /** Request body (JSON object, FormData, string, etc.) */\r\n  body?: any;\r\n  \r\n  /** Query parameters to append to URL */\r\n  params?: Record<string, string | number | boolean>;\r\n  \r\n  /** Request timeout in milliseconds */\r\n  timeout?: number;\r\n  \r\n  /** Expected response type */\r\n  responseType?: 'json' | 'text' | 'arrayBuffer' | 'blob';\r\n\r\n  /** Override proxy endpoint for this request */\r\n  proxyUrl?: string;\r\n}\r\n\r\n/**\r\n * CorsBridge Error Response (Backend format)\r\n */\r\nexport interface ErrorResponse {\r\n  error: boolean;\r\n  message: string;\r\n  statusCode: number;\r\n  requestId?: string;\r\n  traceId?: string;\r\n  spanId?: string;\r\n  timestamp?: string;\r\n  details?: Record<string, unknown>;\r\n}\r\n\r\n/**\r\n * CorsBridge Response (generic type for successful responses)\r\n */\r\nexport type CorsBridgeResponse<T = any> = T;\r\n\r\n/**\r\n * CorsBridge Error Details\r\n */\r\nexport interface CorsBridgeErrorDetails {\r\n  requestId?: string;\r\n  traceId?: string;\r\n  spanId?: string;\r\n  code?: string;\r\n  retryAfter?: number;\r\n  blockedUrl?: string;\r\n  [key: string]: any;\r\n}\r\n\r\n/**\r\n * Alias for CorsFetchOptions (for backwards compatibility and clarity)\r\n */\r\nexport type CorsBridgeOptions = CorsFetchOptions;\r\n\r\n/**\r\n * Error types mapped from backend\r\n */\r\nexport enum ErrorType {\r\n  VALIDATION = 'ValidationError',\r\n  RATE_LIMIT = 'RateLimitError',\r\n  PAYLOAD_TOO_LARGE = 'PayloadTooLargeError',\r\n  BAD_GATEWAY = 'BadGatewayError',\r\n  GATEWAY_TIMEOUT = 'GatewayTimeoutError',\r\n  HTTP_ERROR = 'HttpError',\r\n  NETWORK_ERROR = 'NetworkError',\r\n}\r\n\r\n","import { ErrorType, CorsBridgeErrorDetails } from './types';\r\n\r\n/**\r\n * Base CorsBridge Error\r\n */\r\nexport class CorsBridgeError extends Error {\r\n  public readonly type: string;\r\n  public readonly statusCode: number;\r\n  public readonly details?: CorsBridgeErrorDetails;\r\n  public requestId?: string;\r\n  public traceId?: string;\r\n  public spanId?: string;\r\n\r\n  constructor(\r\n    message: string,\r\n    type: string,\r\n    statusCode: number,\r\n    details?: CorsBridgeErrorDetails,\r\n    requestId?: string,\r\n    traceId?: string,\r\n    spanId?: string,\r\n  ) {\r\n    super(message);\r\n    this.name = 'CorsBridgeError';\r\n    this.type = type;\r\n    this.statusCode = statusCode;\r\n    this.details = details;\r\n    this.requestId = requestId;\r\n    this.traceId = traceId;\r\n    this.spanId = spanId;\r\n    Object.setPrototypeOf(this, CorsBridgeError.prototype);\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      name: this.name,\r\n      message: this.message,\r\n      type: this.type,\r\n      statusCode: this.statusCode,\r\n      details: this.details,\r\n      requestId: this.requestId,\r\n      traceId: this.traceId,\r\n      spanId: this.spanId,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Validation Error (400, 403, 414)\r\n */\r\nexport class ValidationError extends CorsBridgeError {\r\n  constructor(message: string, statusCode = 400, details?: CorsBridgeErrorDetails) {\r\n    super(message, ErrorType.VALIDATION, statusCode, details);\r\n    this.name = 'ValidationError';\r\n    Object.setPrototypeOf(this, ValidationError.prototype);\r\n  }\r\n}\r\n\r\n/**\r\n * Rate limit exceeded (429)\r\n */\r\nexport class RateLimitError extends CorsBridgeError {\r\n  constructor(message: string, details?: CorsBridgeErrorDetails) {\r\n    super(message, ErrorType.RATE_LIMIT, 429, details);\r\n    this.name = 'RateLimitError';\r\n    Object.setPrototypeOf(this, RateLimitError.prototype);\r\n  }\r\n}\r\n\r\n/**\r\n * Payload too large (413)\r\n */\r\nexport class PayloadTooLargeError extends CorsBridgeError {\r\n  constructor(message: string, details?: CorsBridgeErrorDetails) {\r\n    super(message, ErrorType.PAYLOAD_TOO_LARGE, 413, details);\r\n    this.name = 'PayloadTooLargeError';\r\n    Object.setPrototypeOf(this, PayloadTooLargeError.prototype);\r\n  }\r\n}\r\n\r\n/**\r\n * Bad Gateway (502)\r\n */\r\nexport class BadGatewayError extends CorsBridgeError {\r\n  constructor(message: string, details?: CorsBridgeErrorDetails) {\r\n    super(message, ErrorType.BAD_GATEWAY, 502, details);\r\n    this.name = 'BadGatewayError';\r\n    Object.setPrototypeOf(this, BadGatewayError.prototype);\r\n  }\r\n}\r\n\r\n/**\r\n * Gateway Timeout (504)\r\n */\r\nexport class GatewayTimeoutError extends CorsBridgeError {\r\n  constructor(message: string, details?: CorsBridgeErrorDetails) {\r\n    super(message, ErrorType.GATEWAY_TIMEOUT, 504, details);\r\n    this.name = 'GatewayTimeoutError';\r\n    Object.setPrototypeOf(this, GatewayTimeoutError.prototype);\r\n  }\r\n}\r\n\r\n/**\r\n * Network error (client-side)\r\n */\r\nexport class NetworkError extends CorsBridgeError {\r\n  constructor(message: string, details?: CorsBridgeErrorDetails) {\r\n    super(message, ErrorType.NETWORK_ERROR, 0, details);\r\n    this.name = 'NetworkError';\r\n    Object.setPrototypeOf(this, NetworkError.prototype);\r\n  }\r\n}\r\n\r\n/**\r\n * Host Blocked Error (403) - Private IPs, localhost\r\n */\r\nexport class HostBlockedError extends ValidationError {\r\n  constructor(message: string, details?: CorsBridgeErrorDetails) {\r\n    super(message, 403, details);\r\n    this.name = 'HostBlockedError';\r\n    Object.setPrototypeOf(this, HostBlockedError.prototype);\r\n  }\r\n}\r\n\r\n/**\r\n * SSRF Blocked Error (403) - SSRF attempts\r\n */\r\nexport class SSRFBlockedError extends ValidationError {\r\n  constructor(message: string, details?: CorsBridgeErrorDetails) {\r\n    super(message, 403, details);\r\n    this.name = 'SSRFBlockedError';\r\n    Object.setPrototypeOf(this, SSRFBlockedError.prototype);\r\n  }\r\n}\r\n\r\n/**\r\n * Invalid URL Error (414) - URL too long\r\n */\r\nexport class InvalidURLError extends ValidationError {\r\n  constructor(message: string, details?: CorsBridgeErrorDetails) {\r\n    super(message, 414, details);\r\n    this.name = 'InvalidURLError';\r\n    Object.setPrototypeOf(this, InvalidURLError.prototype);\r\n  }\r\n}\r\n\r\n/**\r\n * Timeout Error (504) - Request timeout\r\n * Alias for GatewayTimeoutError\r\n */\r\nexport class TimeoutError extends GatewayTimeoutError {\r\n  constructor(message: string, details?: CorsBridgeErrorDetails) {\r\n    super(message, details);\r\n    this.name = 'TimeoutError';\r\n    Object.setPrototypeOf(this, TimeoutError.prototype);\r\n  }\r\n}\r\n\r\n/**\r\n * Target Error (502) - Target server error\r\n * Alias for BadGatewayError\r\n */\r\nexport class TargetError extends BadGatewayError {\r\n  constructor(message: string, details?: CorsBridgeErrorDetails) {\r\n    super(message, details);\r\n    this.name = 'TargetError';\r\n    Object.setPrototypeOf(this, TargetError.prototype);\r\n  }\r\n}\r\n\r\n/**\r\n * Map backend error response to appropriate error class\r\n */\r\nexport function createErrorFromResponse(\r\n  errorData: any,\r\n  statusCode: number,\r\n): CorsBridgeError {\r\n  const message = errorData.message || 'Unknown error';\r\n  const details = errorData.details;\r\n  const requestId = errorData.requestId;\r\n  const traceId = errorData.traceId;\r\n  const spanId = errorData.spanId;\r\n  \r\n  // Helper to set error metadata\r\n  const setMetadata = (error: CorsBridgeError) => {\r\n    error.requestId = requestId;\r\n    error.traceId = traceId;\r\n    error.spanId = spanId;\r\n    return error;\r\n  };\r\n\r\n  // Check message patterns for specific error types (status code 400-403-414)\r\n  if (statusCode === 400 || statusCode === 403 || statusCode === 414) {\r\n    const lowerMessage = message.toLowerCase();\r\n    \r\n    // DNS/Network errors (400)\r\n    if (statusCode === 400 && (\r\n      lowerMessage.includes('unable to resolve') ||\r\n      lowerMessage.includes('dns') ||\r\n      lowerMessage.includes('hostname')\r\n    )) {\r\n      return setMetadata(new NetworkError(message, details));\r\n    }\r\n    \r\n    // Host blocked errors (403)\r\n    if (statusCode === 403) {\r\n      // Check backend's reason field first (most specific)\r\n      if (details?.reason === 'ssrf_attempt') {\r\n        return setMetadata(new SSRFBlockedError(message, details));\r\n      }\r\n      \r\n      if (details?.reason === 'host_blocked') {\r\n        return setMetadata(new HostBlockedError(message, details));\r\n      }\r\n      \r\n      // Fallback to message/pattern matching (for backward compatibility)\r\n      // SSRF specific patterns - check first (more specific)\r\n      if (message.includes('169.254') || \r\n          lowerMessage.includes('metadata') || \r\n          lowerMessage.includes('ssrf') ||\r\n          details?.hostname?.includes('.local') ||\r\n          details?.hostname?.includes('.internal') ||\r\n          details?.hostname?.includes('.intranet')) {\r\n        return setMetadata(new SSRFBlockedError(message, details));\r\n      }\r\n      \r\n      // Private IP blocking or localhost\r\n      // Backend messages:\r\n      // - \"Resolved address is not reachable from public network\" (for private IPs)\r\n      // - \"Access to private/internal hosts is not allowed\" (for localhost)\r\n      if (lowerMessage.includes('not reachable') ||\r\n          lowerMessage.includes('private') ||\r\n          lowerMessage.includes('internal') ||\r\n          lowerMessage.includes('blocked') ||\r\n          lowerMessage.includes('localhost') ||\r\n          details?.address) {\r\n        return setMetadata(new HostBlockedError(message, details));\r\n      }\r\n      \r\n      // General 403 forbidden\r\n      return setMetadata(new ValidationError(message, statusCode, details));\r\n    }\r\n    \r\n    // URL length errors (414)\r\n    if (statusCode === 414 && (\r\n      lowerMessage.includes('url exceeds') ||\r\n      lowerMessage.includes('too long') ||\r\n      lowerMessage.includes('maximum allowed length')\r\n    )) {\r\n      return setMetadata(new InvalidURLError(message, details));\r\n    }\r\n    \r\n    // Default validation error\r\n    return setMetadata(new ValidationError(message, statusCode, details));\r\n  }\r\n\r\n  // Map by status code for other errors\r\n  switch (statusCode) {\r\n    case 413:\r\n      return setMetadata(new PayloadTooLargeError(message, details));\r\n    \r\n    case 429:\r\n      return setMetadata(new RateLimitError(message, details));\r\n    \r\n    case 502:\r\n      // Check if it's a proxy error or target server error\r\n      // Proxy errors have specific messages like \"Target host not reachable\"\r\n      // Target server 502 errors typically just have \"HTTP 502: Bad Gateway\"\r\n      const lowerMsg = message.toLowerCase();\r\n      if (lowerMsg.includes('not reachable') ||\r\n          lowerMsg.includes('connection') ||\r\n          lowerMsg.includes('redirect')) {\r\n        return setMetadata(new BadGatewayError(message, details));\r\n      }\r\n      // Otherwise, treat as target server error\r\n      return setMetadata(new TargetError(message, details));\r\n    \r\n    case 504:\r\n      // Check if it's a timeout error\r\n      if (message.toLowerCase().includes('timeout')) {\r\n        return setMetadata(new TimeoutError(message, details));\r\n      }\r\n      return setMetadata(new GatewayTimeoutError(message, details));\r\n    \r\n    default:\r\n      // Handle 5xx errors from target server as TargetError\r\n      if (statusCode >= 500 && statusCode < 600) {\r\n        return setMetadata(new TargetError(message, details));\r\n      }\r\n      \r\n      return new CorsBridgeError(\r\n        message,\r\n        ErrorType.HTTP_ERROR,\r\n        statusCode,\r\n        details,\r\n        requestId,\r\n        traceId,\r\n        spanId,\r\n      );\r\n  }\r\n}\r\n\r\n","import { CorsFetchOptions, ErrorResponse } from './types';\r\nimport './tls';\r\nimport {\r\n  createErrorFromResponse,\r\n  NetworkError,\r\n  TimeoutError,\r\n  ValidationError,\r\n  CorsBridgeError,\r\n} from './errors';\r\n\r\nconst DEFAULT_PROXY_ENDPOINT = 'https://api.cors.syrins.tech';\r\n\r\nconst timeoutLikeErrorCodes = new Set([\r\n  'UND_ERR_CONNECT_TIMEOUT',\r\n  'UND_ERR_HEADERS_TIMEOUT',\r\n  'UND_ERR_BODY_TIMEOUT',\r\n  'UND_ERR_ABORTED',\r\n  'ECONNRESET',\r\n  'ETIMEDOUT',\r\n  'ECONNABORTED',\r\n]);\r\n\r\nconst CONTENT_TYPE_HEADER = 'Content-Type';\r\n\r\nfunction getProxyURL(override?: string): string {\r\n  if (override && override.trim().length > 0) {\r\n    return override.trim().replace(/\\/?$/, '');\r\n  }\r\n  const envTarget = process.env.CORS_PROXY_URL?.trim();\r\n  return (envTarget && envTarget.length > 0 ? envTarget : DEFAULT_PROXY_ENDPOINT).replace(/\\/?$/, '');\r\n}\r\n\r\n/**\r\n * Build query string from params object\r\n */\r\nfunction buildQueryString(params: Record<string, string | number | boolean>): string {\r\n  const searchParams = new URLSearchParams();\r\n  Object.entries(params).forEach(([key, value]) => {\r\n    searchParams.append(key, String(value));\r\n  });\r\n  return searchParams.toString();\r\n}\r\n\r\n/**\r\n * Validate URL format (basic check)\r\n */\r\nfunction validateURL(url: string): void {\r\n  if (!url || typeof url !== 'string') {\r\n    throw new ValidationError('URL must be a non-empty string');\r\n  }\r\n  \r\n  if (!url.trim()) {\r\n    throw new ValidationError('URL cannot be empty');\r\n  }\r\n  \r\n  // Basic protocol check\r\n  if (!/^https?:\\/\\/.+/i.test(url.trim())) {\r\n    throw new ValidationError('URL must start with http:// or https://');\r\n  }\r\n}\r\n\r\n/**\r\n * Build the proxied URL\r\n */\r\nfunction buildProxyURL(\r\n  targetUrl: string,\r\n  params?: Record<string, string | number | boolean>,\r\n  proxyOverride?: string,\r\n): string {\r\n  validateURL(targetUrl);\r\n\r\n  let finalUrl = targetUrl.trim();\r\n  if (params && Object.keys(params).length > 0) {\r\n    const queryString = buildQueryString(params);\r\n    const separator = finalUrl.includes('?') ? '&' : '?';\r\n    finalUrl = `${finalUrl}${separator}${queryString}`;\r\n  }\r\n\r\n  const encodedUrl = encodeURIComponent(finalUrl);\r\n  return `${getProxyURL(proxyOverride)}/?url=${encodedUrl}`;\r\n}\r\n\r\nfunction findContentTypeHeader(headers: Record<string, string>): string | null {\r\n  return Object.keys(headers).find((key) => key.toLowerCase() === 'content-type') ?? null;\r\n}\r\n\r\nfunction setContentType(headers: Record<string, string>, value: string): void {\r\n  const existingKey = findContentTypeHeader(headers);\r\n  if (existingKey) {\r\n    headers[existingKey] = value;\r\n  } else {\r\n    headers[CONTENT_TYPE_HEADER] = value;\r\n  }\r\n}\r\n\r\nfunction deleteContentType(headers: Record<string, string>): void {\r\n  const existingKey = findContentTypeHeader(headers);\r\n  if (existingKey) {\r\n    delete headers[existingKey];\r\n  }\r\n}\r\n\r\n/**\r\n * Create fetch request with timeout\r\n */\r\nasync function fetchWithTimeout(\r\n  url: string,\r\n  options: RequestInit,\r\n  timeout?: number\r\n): Promise<Response> {\r\n  if (!timeout) {\r\n    return fetch(url, options);\r\n  }\r\n\r\n  const controller = new AbortController();\r\n  const timeoutId = setTimeout(() => controller.abort(), timeout);\r\n\r\n  try {\r\n    const response = await fetch(url, {\r\n      ...options,\r\n      signal: controller.signal,\r\n    });\r\n    clearTimeout(timeoutId);\r\n    return response;\r\n  } catch (error: any) {\r\n    clearTimeout(timeoutId);\r\n    if (error.name === 'AbortError') {\r\n      throw new TimeoutError(`Request timeout after ${timeout}ms`);\r\n    }\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Process response based on type\r\n */\r\nasync function processResponse(\r\n  response: Response,\r\n  responseType: CorsFetchOptions['responseType'] = 'json'\r\n): Promise<any> {\r\n  switch (responseType) {\r\n    case 'text':\r\n      return await response.text();\r\n    case 'arrayBuffer':\r\n      return await response.arrayBuffer();\r\n    case 'blob':\r\n      return await response.blob();\r\n    case 'json':\r\n    default:\r\n      const text = await response.text();\r\n      try {\r\n        return JSON.parse(text);\r\n      } catch {\r\n        return text;\r\n      }\r\n  }\r\n}\r\n\r\n/**\r\n * Main corsFetch function\r\n * \r\n * @param targetUrl - The URL to fetch (will be proxied through CorsBridge)\r\n * @param options - Request options\r\n * @returns Promise with the response data\r\n * \r\n * @example\r\n * ```ts\r\n * const data = await corsFetch('https://api.example.com/users');\r\n * ```\r\n * \r\n * @example\r\n * ```ts\r\n * const data = await corsFetch('https://api.example.com/users', {\r\n *   method: 'POST',\r\n *   body: { name: 'John' },\r\n *   headers: { 'Authorization': 'Bearer token' }\r\n * });\r\n * ```\r\n */\r\nexport async function corsFetch<T = any>(\r\n  targetUrl: string,\r\n  options: CorsFetchOptions = {},\r\n): Promise<T> {\r\n  const {\r\n    method = 'GET',\r\n    headers = {},\r\n    body,\r\n    params,\r\n    timeout,\r\n    responseType = 'json',\r\n    proxyUrl,\r\n  } = options;\r\n\r\n  const resolvedHeaders: Record<string, string> = { ...headers };\r\n  let resolvedBody: RequestInit['body'];\r\n\r\n  if (body !== undefined) {\r\n    if (typeof body === 'string') {\r\n      resolvedBody = body;\r\n      if (!findContentTypeHeader(resolvedHeaders)) {\r\n        setContentType(resolvedHeaders, 'text/plain;charset=UTF-8');\r\n      }\r\n    } else if (\r\n      body instanceof FormData ||\r\n      body instanceof Blob ||\r\n      body instanceof ArrayBuffer ||\r\n      body instanceof URLSearchParams\r\n    ) {\r\n      resolvedBody = body as BodyInit;\r\n      if (body instanceof FormData) {\r\n        deleteContentType(resolvedHeaders);\r\n      }\r\n    } else {\r\n      resolvedBody = JSON.stringify(body);\r\n      if (!findContentTypeHeader(resolvedHeaders)) {\r\n        setContentType(resolvedHeaders, 'application/json');\r\n      }\r\n    }\r\n  }\r\n\r\n  const fetchOptions: RequestInit = {\r\n    method,\r\n    headers: Object.keys(resolvedHeaders).length > 0 ? resolvedHeaders : undefined,\r\n    body: resolvedBody,\r\n  };\r\n\r\n  const proxyEndpoint = buildProxyURL(targetUrl, params, proxyUrl);\r\n\r\n  try {\r\n    // Make the request with optional timeout\r\n    const response = await fetchWithTimeout(proxyEndpoint, fetchOptions, timeout);\r\n\r\n    // Handle error responses\r\n    if (!response.ok) {\r\n      const errorData: ErrorResponse = await response.json().catch(() => ({\r\n        error: true,\r\n        message: `HTTP ${response.status}: ${response.statusText}`,\r\n        statusCode: response.status,\r\n      }));\r\n\r\n      throw createErrorFromResponse(errorData, response.status);\r\n    }\r\n\r\n    // Process successful response\r\n    return await processResponse(response, responseType);\r\n  } catch (error: any) {\r\n    // If it's already a CorsBridge error, rethrow it\r\n    if (error instanceof CorsBridgeError) {\r\n      throw error;\r\n    }\r\n\r\n    // Handle network errors\r\n    if (error instanceof TypeError && error.message.includes('fetch')) {\r\n    const errorCode = extractErrorCode(error);\r\n    if (isTimeoutLikeError(error, errorCode)) {\r\n      throw new TimeoutError('Network request timed out before proxy responded', {\r\n        code: errorCode,\r\n        originalMessage: error.message,\r\n      });\r\n    }\r\n    throw new NetworkError('Network request failed', {\r\n      originalMessage: error.message,\r\n      errorName: error.name,\r\n      code: errorCode,\r\n    });\r\n  }\r\n\r\n    // Rethrow unknown errors\r\n    throw error;\r\n  }\r\n}\r\n\r\nfunction extractErrorCode(error: any): string | undefined {\r\n  return (\r\n    (error && typeof error === 'object' && 'code' in error ? (error as NodeJS.ErrnoException).code : undefined) ??\r\n    (error?.cause && typeof error.cause === 'object' && 'code' in error.cause\r\n      ? ((error.cause as NodeJS.ErrnoException).code as string)\r\n      : undefined)\r\n  );\r\n}\r\n\r\nfunction isTimeoutLikeError(error: Error, code?: string): boolean {\r\n  if (code && timeoutLikeErrorCodes.has(code)) {\r\n    return true;\r\n  }\r\n\r\n  return /timeout|timed out|aborted|socket hang up/i.test(error.message);\r\n}\r\n\r\n/**\r\n * Convenience methods for different HTTP methods\r\n */\r\nexport const corsGet = <T = any>(url: string, options?: Omit<CorsFetchOptions, 'method'>) =>\r\n  corsFetch<T>(url, { ...options, method: 'GET' });\r\n\r\nexport const corsPost = <T = any>(url: string, body?: any, options?: Omit<CorsFetchOptions, 'method' | 'body'>) =>\r\n  corsFetch<T>(url, { ...options, method: 'POST', body });\r\n\r\nexport const corsPut = <T = any>(url: string, body?: any, options?: Omit<CorsFetchOptions, 'method' | 'body'>) =>\r\n  corsFetch<T>(url, { ...options, method: 'PUT', body });\r\n\r\nexport const corsPatch = <T = any>(url: string, body?: any, options?: Omit<CorsFetchOptions, 'method' | 'body'>) =>\r\n  corsFetch<T>(url, { ...options, method: 'PATCH', body });\r\n\r\nexport const corsDelete = <T = any>(url: string, options?: Omit<CorsFetchOptions, 'method'>) =>\r\n  corsFetch<T>(url, { ...options, method: 'DELETE' });\r\n\r\n"],"mappings":"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","names":["https","UndiciAgent","ErrorType"]}